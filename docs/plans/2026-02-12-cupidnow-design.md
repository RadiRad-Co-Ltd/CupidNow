# CupidNow — LINE 聊天分析應用設計文件

> 用數據，看見愛情的溫度

## 1. 產品概覽

CupidNow 是一款 Web 應用，使用者上傳 LINE 匯出的 txt 對話紀錄後，系統自動分析雙方的聊天頻率、互動模式、情緒變化等數據，以浪漫風格的視覺化報告呈現，讓使用者「用數據感受愛情」。

**核心理念**：浪漫感 + 數據清晰度並存。UI 有戀愛感，但數據一目瞭然。

**使用模式**：一次性分析。上傳 → 分析 → 查看報告 → 結束。不需要帳號系統，不做持久化儲存。

## 2. 技術架構

### 技術棧

| 層級 | 技術 |
|------|------|
| 前端 | React + Vite + TailwindCSS |
| 圖表 | Recharts / D3.js |
| 後端 | Python + FastAPI |
| 數據分析 | pandas, jieba (中文斷詞), wordcloud |
| AI 分析 | Claude API (Anthropic) |
| 加密 | AES-256-GCM (前端加密) + HTTPS |

### 架構圖

```
┌─────────────────┐     HTTPS + AES     ┌──────────────────┐
│   React + Vite  │ ◄──────────────────► │  Python FastAPI   │
│   TailwindCSS   │    加密傳輸/結果      │  jieba / pandas   │
│   Recharts/D3   │                      │  wordcloud        │
└─────────────────┘                      └────────┬─────────┘
                                                  │ 摘要抽樣
                                                  ▼
                                         ┌──────────────────┐
                                         │   Claude API      │
                                         │   情緒分析/金句    │
                                         └──────────────────┘
```

### AI 混合策略

為了控制成本，採用「本地處理 80% + AI 精華分析 20%」策略：
- **本地端**：訊息解析、所有統計數據、中文斷詞、文字雲、熱點圖 — 全在 Python 後端完成
- **Claude API**：僅處理「摘要抽樣」後的精華內容（每日抽 5-10 則代表性訊息），進行情緒分析、金句挑選、綜合評語生成

## 3. 資安策略

### 加密與隱私

- **傳輸加密**：前端使用 AES-256-GCM 加密檔案後才上傳，HTTPS 雙重保護
- **記憶體處理**：後端解密後僅在記憶體中處理，絕不寫入磁碟
- **即時銷毀**：分析完成後立即清除所有原始數據，僅回傳統計結果（不含原始訊息）
- **無帳號系統**：不收集任何使用者個人資訊
- **金句例外**：AI 挑選的金句會包含原始文字，但僅在使用者瀏覽器端顯示，不做伺服器端儲存

### 加密流程

1. 前端生成隨機 AES-256 金鑰
2. 使用 AES-256-GCM 加密上傳檔案
3. 金鑰透過 HTTPS 傳送至後端（可考慮 RSA 公鑰加密金鑰的方式進一步強化）
4. 後端記憶體中解密 → 處理 → 清除

## 4. 功能模組設計

### 模組 A — 基礎統計分析（本地處理）

| 指標 | 說明 | 視覺化 |
|------|------|--------|
| 訊息條數 | 雙方各發多少訊息 | 比例圓餅圖 + 數字卡片 |
| 字數統計 | 平均每則訊息長度、總字數 | 雙方對比長條圖 |
| 貼圖/圖片/影片 | 各類型訊息數量 | 分類統計卡片 |
| 通話紀錄 | 通話次數、總時長、平均時長、最長通話 | 統計卡片 + 時長分布圖 |

### 模組 B — 回覆行為分析（本地處理）

| 指標 | 說明 | 視覺化 |
|------|------|--------|
| 秒回率 | 60 秒內回覆的比例 | 雙方對比百分比 + 進度條 |
| 平均回覆時間 | 分時段統計（上班/下班/深夜） | 分時段長條圖 |
| 回覆速度分布 | <1min / 1-5min / 5-30min / 30min-1hr / >1hr | 直方圖 |
| 已讀不回偵測 | 超過特定時間未回的次數 | 幽默風格統計卡片 |
| 話題發起者 | 沉默超過 4hr 後先發訊息的人 | 比例圖 |
| 冷戰/危機偵測 | 訊息量驟降 + 回覆時間急遽拉長的時期 | 時間軸標記（支援日/週/月切換） |

### 模組 C — 時間模式分析（本地處理）

| 指標 | 說明 | 視覺化 |
|------|------|--------|
| 活躍時段熱點圖 | 24hr x 7天的訊息密度 | 色塊熱力圖 |
| 對話活躍趨勢 | 訊息量隨時間變化 | 折線圖（支援日/週/月切換） |
| 晚安分析 | 誰先說早安/晚安、最晚聊到幾點、睡前聊天時長 | 統計卡片 + 時間軸 |

### 模組 D — AI 分析（Claude API）

| 指標 | 說明 | 視覺化 |
|------|------|--------|
| 情緒分析 | 每日情緒基調（甜蜜/曖昧/日常/爭吵/思念） | 情緒趨勢圖 + 分布圖 |
| 金句賞析 | 最甜、最好笑、最心動的 Top 5 句子 | 精美卡片展示 |
| 愛情溫度計 | 綜合所有指標的 0-100 分數 + AI 評語 | 大型動畫溫度計 |

### 模組 E — 文字分析視覺化（本地處理）

| 指標 | 說明 | 視覺化 |
|------|------|--------|
| 文字雲 | 雙方各自的高頻詞 | 愛心形狀文字雲 |
| 專屬用語 | 只有你們之間才用的暱稱或特殊用語 | 列表 + 使用次數 |

### 全局功能

- **時間粒度切換**：所有時間相關圖表支援「日 / 週 / 月」三種粒度
- **一鍵分享**：生成精美的「愛情報告摘要卡」圖片，可下載或分享至社群（僅包含摘要數據，不含對話原文）

## 5. UI 頁面設計

### 設計風格

- **主題**：浪漫戀愛風，但保持數據的清晰可讀
- **配色**：暖粉色系為主，搭配白色/淺色背景確保數據清晰
- **字型**：數據部分使用清晰的無襯線字體，標題可用手寫感字體增添浪漫
- **動畫**：適度的愛心、星星、漸層動畫增加氛圍感
- **UI 設計工具**：使用 Pencil 設計前端 mockup

### 頁面 1 — 上傳頁（Landing Page）

```
┌─────────────────────────────────────┐
│          CupidNow Logo              │
│    「用數據，看見愛情的溫度」           │
├─────────────────────────────────────┤
│                                     │
│     ┌─────────────────────────┐     │
│     │                         │     │
│     │   💌 拖放或點擊上傳      │     │
│     │   LINE 對話記錄 (.txt)  │     │
│     │                         │     │
│     └─────────────────────────┘     │
│                                     │
│  ① 匯出 LINE 記錄  ② 上傳  ③ 查看  │
│                                     │
│  🔒 加密傳輸・分析完即刪・隱私安全    │
└─────────────────────────────────────┘
```

### 頁面 2 — 分析報告頁（Dashboard）

單頁式長捲軸報告，區塊由上到下排列：

```
┌─────────────────────────────────────┐
│  1. 愛情溫度計 Hero Section          │  ← 0-100 分 + 動畫溫度計 + AI 評語
├─────────────────────────────────────┤
│  2. 基礎統計卡片                     │  ← 訊息數/字數/貼圖 雙方對比
├─────────────────────────────────────┤
│  3. 回覆行為區                       │  ← 秒回率/回覆分布/已讀不回
├─────────────────────────────────────┤
│  4. 時間模式區                       │  ← 24x7 熱力圖 + 趨勢圖（日/週/月）
├─────────────────────────────────────┤
│  5. 晚安分析區                       │  ← 早安晚安/睡前習慣
├─────────────────────────────────────┤
│  6. 通話分析區                       │  ← 通話次數/時長
├─────────────────────────────────────┤
│  7. 冷戰偵測時間軸                   │  ← 危機時期標記（日/週/月）
├─────────────────────────────────────┤
│  8. 情緒分析區                       │  ← 情緒趨勢圖 + 分布
├─────────────────────────────────────┤
│  9. 文字雲 & 專屬用語                │  ← 愛心文字雲 + 特殊用語
├─────────────────────────────────────┤
│  10. 金句賞析                        │  ← AI 精選句子卡片
├─────────────────────────────────────┤
│  📤 分享報告  📥 下載報告卡          │
└─────────────────────────────────────┘

右側浮動：快速導航（跳轉各區塊）
```

### 等待頁面

上傳後分析期間顯示帶動畫的等待頁面：
- 浪漫風格進度條
- 動態文案輪播：「正在解讀你們的故事...」「計算心動的瞬間...」「分析甜蜜指數...」
- 使用 SSE (Server-Sent Events) 推送即時進度

## 6. API 設計

### 端點

```
POST /api/analyze
├── Request:  multipart/form-data
│   ├── file: 加密的 LINE txt 檔案
│   └── key: AES 加密金鑰（base64 encoded）
├── Response: SSE stream 推送進度 + 最終 JSON 結果
└── 預估處理時間: 10-30 秒

GET  /api/health
└── 健康檢查
```

### 後端處理 Pipeline

```
1. 接收加密檔案 → AES-256-GCM 解密（記憶體中）
2. LINE txt 解析器 → 結構化訊息列表
   ├── 辨識發送者、時間戳、訊息類型（文字/貼圖/圖片/影片/通話）
   └── 處理 LINE 匯出格式的各種邊界情況（多行訊息、特殊字元等）
3. 統計分析引擎（pandas）
   ├── 基礎統計（訊息數、字數、類型統計）
   ├── 回覆行為分析（秒回率、回覆時間分布、已讀不回）
   ├── 時間模式分析（熱力圖數據、活躍趨勢、日/週/月粒度）
   ├── 晚安分析（早安晚安偵測、睡前模式）
   ├── 冷戰偵測（訊息量驟降 + 回覆延遲的組合判斷）
   ├── 話題發起者統計
   └── 通話統計
4. 文字分析（jieba + wordcloud）
   ├── 中文斷詞 → 詞頻統計 → 文字雲數據
   └── 專屬用語偵測（TF-IDF 偵測此對話中獨特的高頻詞）
5. AI 分析（Claude API）
   ├── 摘要抽樣：每日抽 5-10 則代表性訊息
   ├── 情緒分析：每日情緒分類（甜蜜/曖昧/日常/爭吵/思念）
   ├── 金句挑選：最甜/最好笑/最心動 Top 5
   └── 愛情溫度：綜合評分 0-100 + 關係洞察評語
6. 組合所有結果 → 回傳 JSON
7. 清除所有記憶體中的原始數據
```

### 回應 JSON 結構（摘要）

```json
{
  "loveScore": { "score": 87, "comment": "..." },
  "basicStats": { "messageCount": {}, "wordCount": {}, ... },
  "replyBehavior": { "instantReplyRate": {}, "avgReplyTime": {}, ... },
  "timePatterns": { "heatmap": [], "trend": [], ... },
  "goodnightAnalysis": { ... },
  "callAnalysis": { ... },
  "coldWarDetection": [ ... ],
  "sentimentAnalysis": { "dailyTrend": [], "distribution": {} },
  "wordCloud": { "person1": [], "person2": [] },
  "uniquePhrases": [ ... ],
  "goldenQuotes": { "sweetest": [], "funniest": [], "mostTouching": [] },
  "shareCard": { "summary": {} }
}
```

## 7. 專案目錄結構

```
CupidNow/
├── docs/
│   └── plans/
│       └── 2026-02-12-cupidnow-design.md
├── frontend/                  # React + Vite
│   ├── src/
│   │   ├── components/
│   │   │   ├── UploadPage/    # 上傳頁面
│   │   │   ├── Dashboard/     # 報告頁面
│   │   │   ├── Charts/        # 圖表元件
│   │   │   ├── ShareCard/     # 分享卡片
│   │   │   └── common/        # 共用元件
│   │   ├── hooks/             # 自定義 hooks
│   │   ├── utils/
│   │   │   └── encryption.ts  # AES 加密工具
│   │   ├── types/             # TypeScript 型別
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── package.json
│   ├── vite.config.ts
│   └── tailwind.config.ts
├── backend/                   # Python FastAPI
│   ├── app/
│   │   ├── main.py            # FastAPI 入口
│   │   ├── routers/
│   │   │   └── analyze.py     # 分析 API
│   │   ├── services/
│   │   │   ├── parser.py      # LINE txt 解析器
│   │   │   ├── stats.py       # 統計分析引擎
│   │   │   ├── text_analysis.py  # 文字分析（斷詞/文字雲）
│   │   │   ├── ai_analysis.py    # Claude API 情緒分析
│   │   │   └── encryption.py     # 解密工具
│   │   ├── models/            # Pydantic models
│   │   └── utils/
│   ├── requirements.txt
│   └── pyproject.toml
└── README.md
```

## 8. 實作優先順序

### Phase 1 — 核心功能（MVP）
1. LINE txt 解析器
2. 基礎統計分析
3. 回覆行為分析
4. 前端上傳頁 + 基礎報告頁
5. 加密傳輸機制

### Phase 2 — 視覺化增強
6. 時間模式熱力圖
7. 活躍趨勢圖（日/週/月切換）
8. 晚安分析
9. 通話統計

### Phase 3 — AI 與進階功能
10. Claude API 情緒分析
11. 金句賞析
12. 愛情溫度計
13. 冷戰偵測

### Phase 4 — 完善體驗
14. 文字雲（愛心形狀）
15. 專屬用語偵測
16. 分享卡片生成
17. 等待動畫與 SSE 進度推送
18. UI 動畫與細節打磨
